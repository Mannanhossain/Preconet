<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel â€“ Call Manager Pro</title>

  <!-- Tailwind 3.4 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font-awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* Off-canvas sidebar */
    #sidebar { transform: translateX(-100%); transition: transform .3s ease; }
    #sidebar.open { transform: translateX(0); }
    /* Simple skeleton for charts */
    canvas { max-width: 100% !important; }
  </style>
</head>

<body class="bg-gray-50 text-gray-800">

<!-- ==========  OVERLAY  ========== -->
<div id="overlay" class="fixed inset-0 bg-black/40 z-30 hidden lg:hidden"></div>

<!-- ==========  WRAPPER  ========== -->
<div class="flex h-screen overflow-hidden">

  <!-- ==========  SIDEBAR  ========== -->
  <aside id="sidebar" class="fixed lg:relative z-40 w-64 h-full bg-white border-r border-gray-200 flex flex-col">
    <!-- Header -->
    <div class="p-4 border-b border-gray-200 flex items-center justify-between">
      <div>
        <h1 class="text-lg font-bold text-gray-800">Admin Panel</h1>
        <p class="text-xs text-gray-500">Call Manager Pro</p>
      </div>
      <button id="closeSidebar" class="lg:hidden text-gray-500 hover:bg-gray-100 p-2 rounded-full">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Nav -->
    <nav class="flex-1 px-3 py-4 space-y-1">
      <a data-page="dashboard" class="menu-item active-menu flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer transition text-sm font-medium">
        <i class="fas fa-chart-pie w-4"></i>Dashboard
      </a>
      <a data-page="users" class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer transition text-sm font-medium">
        <i class="fas fa-users w-4"></i>Users
      </a>
      <a data-page="createUser" class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer transition text-sm font-medium">
        <i class="fas fa-user-plus w-4"></i>Create User
      </a>
      <a data-page="attendance" class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer transition text-sm font-medium">
        <i class="fas fa-calendar-check w-4"></i>Attendance
      </a>
      <a data-page="callHistory" class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer transition text-sm font-medium">
        <i class="fas fa-phone-alt w-4"></i>Call History
      </a>
      <a data-page="callAnalytics" class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer transition text-sm font-medium">
        <i class="fas fa-chart-bar w-4"></i>Call Analytics
      </a>
      <a data-page="performance" class="menu-item flex items-center gap-3 px-3 py-2.5 rounded-lg cursor-pointer transition text-sm font-medium">
        <i class="fas fa-chart-line w-4"></i>Performance
      </a>
    </nav>

    <!-- Logout -->
    <div class="p-3 border-t border-gray-200">
      <button id="logoutBtn" class="w-full bg-red-600 hover:bg-red-700 text-white py-2.5 rounded-lg text-sm font-medium flex items-center justify-center gap-2">
        <i class="fas fa-sign-out-alt"></i>Logout
      </button>
    </div>
  </aside>

  <!-- ==========  MAIN  ========== -->
  <main class="flex-1 overflow-y-auto w-full">
    <!-- Top-bar -->
    <header class="sticky top-0 bg-white/80 backdrop-blur border-b border-gray-200 px-4 py-3 flex items-center justify-between z-20">
      <div class="flex items-center gap-3">
        <button id="openSidebar" class="lg:hidden text-gray-600 p-2 rounded-full hover:bg-gray-100">
          <i class="fas fa-bars"></i>
        </button>
        <div>
          <h2 id="pageTitle" class="text-base lg:text-xl font-bold text-gray-800">Dashboard</h2>
          <p id="pageSubtitle" class="text-xs text-gray-500">Overview</p>
        </div>
      </div>
      <div id="rightHeader" class="flex items-center gap-2"></div>
    </header>

    <!-- ==========  CONTENT AREA  ========== -->
    <div class="p-4 lg:p-6">
      <!-- Dashboard -->
      <section id="sectionDashboard" class="page-section">
        <div class="mb-6">
          <h3 class="text-lg lg:text-2xl font-bold">Dashboard</h3>
          <p class="text-sm text-gray-600">Welcome back! Here's what's happening today.</p>
        </div>

        <!-- Stat cards -->
        <div id="stats-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"></div>

        <!-- Row charts -->
        <div class="grid lg:grid-cols-2 gap-4 mb-6">
          <div class="bg-white p-4 rounded-xl shadow-sm">
            <h4 class="font-semibold mb-3 flex items-center gap-2"><i class="fas fa-sync text-blue-500"></i>Recent Sync</h4>
            <div id="recent-sync-list" class="space-y-2 text-sm"></div>
          </div>
          <div class="bg-white p-4 rounded-xl shadow-sm">
            <h4 class="font-semibold mb-3 flex items-center gap-2"><i class="fas fa-user-clock text-green-500"></i>User Logs</h4>
            <div id="user-logs-container" class="space-y-2 text-sm"></div>
          </div>
        </div>

        <!-- Trend -->
        <div class="bg-white p-4 rounded-xl shadow-sm">
          <h4 class="font-semibold mb-3 flex items-center gap-2"><i class="fas fa-chart-line text-purple-500"></i>Performance Trend</h4>
          <canvas id="performanceChart" height="120"></canvas>
        </div>
      </section>

      <!-- Users -->
      <section id="sectionUsers" class="page-section hidden">
        <div class="mb-6">
          <h3 class="text-lg lg:text-2xl font-bold">Users</h3>
          <p class="text-sm text-gray-600">Manage all users</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-3 flex flex-col sm:flex-row gap-3 justify-between">
            <div class="relative w-full sm:w-64">
              <input id="userSearchInput" type="text" placeholder="Search users..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
            <div class="flex gap-2">
              <select id="userStatusFilter" class="border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="all">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
              <button id="userFilterBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Filter</button>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="bg-gray-50 text-left">
                <tr>
                  <th class="p-3">User</th>
                  <th class="p-3">Phone</th>
                  <th class="p-3">Performance</th>
                  <th class="p-3">Status</th>
                  <th class="p-3 text-right">Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody" class="divide-y divide-gray-200"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Create User -->
      <section id="sectionCreateUser" class="page-section hidden">
        <div class="mb-6">
          <h3 class="text-lg lg:text-2xl font-bold">Create User</h3>
          <p class="text-sm text-gray-600">Add a new user</p>
        </div>
        <div class="bg-white p-4 lg:p-6 rounded-xl shadow-sm">
          <form id="createUserForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2">
              <label class="block text-sm font-medium mb-1">Full Name</label>
              <input id="userName" required class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Email</label>
              <input id="userEmail" type="email" required class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Phone</label>
              <input id="userPhone" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-medium mb-1">Password</label>
              <input id="userPassword" type="password" required class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="md:col-span-2 flex justify-end">
              <button class="bg-blue-600 hover:bg-blue-700 text-white py-2.5 px-6 rounded-lg">Create User</button>
            </div>
          </form>
        </div>
      </section>

      <!-- Attendance -->
      <section id="sectionAttendance" class="page-section hidden">
        <div class="mb-6">
          <h3 class="text-lg lg:text-2xl font-bold">Attendance</h3>
          <p class="text-sm text-gray-600">Track attendance</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-3 flex flex-col sm:flex-row gap-3 justify-between">
            <div class="flex gap-2">
              <button id="attendanceToday" class="filter-btn bg-blue-600 text-white px-4 py-2 rounded-lg">Today</button>
              <button id="attendanceWeek" class="filter-btn bg-white border border-gray-300 px-4 py-2 rounded-lg">This Week</button>
              <button id="attendanceMonth" class="filter-btn bg-white border border-gray-300 px-4 py-2 rounded-lg">This Month</button>
            </div>
            <button id="exportAttendance" class="bg-white border border-gray-300 px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-gray-50">
              <i class="fas fa-download"></i>Export
            </button>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="bg-gray-50 text-left">
                <tr>
                  <th class="p-3">User</th>
                  <th class="p-3">Check In</th>
                  <th class="p-3">Check Out</th>
                  <th class="p-3">Status</th>
                </tr>
              </thead>
              <tbody id="attendance-table-body" class="divide-y divide-gray-200"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Call History -->
      <section id="sectionCallHistory" class="page-section hidden">
        <div class="mb-6">
          <h3 class="text-lg lg:text-2xl font-bold">Call History</h3>
          <p class="text-sm text-gray-600">Review call records</p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow-sm">
          <div class="mb-3 flex flex-col sm:flex-row gap-3">
            <div class="relative w-full sm:w-64">
              <input id="callSearchInput" type="text" placeholder="Search calls..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
            <select id="callTypeFilter" class="border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="all">All Types</option>
              <option value="incoming">Incoming</option>
              <option value="outgoing">Outgoing</option>
              <option value="missed">Missed</option>
            </select>
          </div>
          <div id="call-history-container" class="overflow-x-auto"></div>
        </div>
      </section>

      <!-- Call Analytics -->
      <section id="sectionCallAnalytics" class="page-section hidden">
        <div class="mb-6">
          <h3 class="text-lg lg:text-2xl font-bold">Call Analytics</h3>
          <p class="text-sm text-gray-600">Detailed analytics</p>
        </div>
        <!-- Cards -->
        <div id="call-analytics-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"></div>
        <!-- Trend -->
        <div class="bg-white p-4 rounded-xl shadow-sm mb-6">
          <h4 class="font-semibold mb-3 flex items-center gap-2"><i class="fas fa-chart-line text-blue-500"></i>Call Volume Trend</h4>
          <canvas id="call-trend-canvas" height="120"></canvas>
        </div>
        <!-- Table -->
        <div class="bg-white p-4 rounded-xl shadow-sm">
          <h4 class="font-semibold mb-3 flex items-center gap-2"><i class="fas fa-table text-purple-500"></i>User-wise Summary</h4>
          <div id="call-analytics-table-container" class="overflow-x-auto"></div>
        </div>
      </section>

      <!-- Performance -->
      <section id="sectionPerformance" class="page-section hidden">
        <div class="mb-6">
          <h3 class="text-lg lg:text-2xl font-bold">Performance</h3>
          <p class="text-sm text-gray-600">Team metrics</p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow-sm">
          <div class="mb-4 flex gap-2">
            <button id="performanceToday" class="filter-btn bg-blue-600 text-white px-4 py-2 rounded-lg">Today</button>
            <button id="performanceWeek" class="filter-btn bg-white border border-gray-300 px-4 py-2 rounded-lg">This Week</button>
            <button id="performanceMonth" class="filter-btn bg-white border border-gray-300 px-4 py-2 rounded-lg">This Month</button>
          </div>
          <canvas id="performanceBarCanvas" height="100"></canvas>
        </div>
      </section>
    </div>
  </main>
</div>

<!-- ==========  NOTIFICATION AREA  ========== -->
<div id="notificationArea" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- ==========  QUICK ACTIONS FAB (mobile)  ========== -->
<div class="fixed bottom-4 right-4 lg:hidden z-40">
  <button id="quickFab" class="bg-blue-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center">
    <i class="fas fa-plus"></i>
  </button>
</div>

<!-- ==========  ORIGINAL JS FILES (unchanged)  ========== -->
<script src="/admin/js/auth.js"></script>
<script src="/admin/js/dashboard.js"></script>
<script src="/admin/js/users.js"></script>
<script src="/admin/js/create_user.js"></script>
<script src="/admin/js/attendance.js"></script>
<script src="/admin/js/call_history.js"></script>
<script src="/admin/js/call_analytics.js"></script>
<script src="/admin/js/performance.js"></script>
<script src="/admin/js/admin.js"></script>

<script>
/* ==========  RESPONSIVE NAV + PAGE ROUTER  ========== */
const sidebar   = document.getElementById('sidebar');
const overlay   = document.getElementById('overlay');
const openBtn   = document.getElementById('openSidebar');
const closeBtn  = document.getElementById('closeSidebar');

openBtn.addEventListener('click', () => { sidebar.classList.add('open'); overlay.classList.remove('hidden'); });
closeBtn.addEventListener('click', closeSidebar);
overlay.addEventListener('click', closeSidebar);

function closeSidebar(){ sidebar.classList.remove('open'); overlay.classList.add('hidden'); }

/* ----------  MENU SWITCH  ---------- */
const menuLinks = document.querySelectorAll('.menu-item');
const sections  = document.querySelectorAll('.page-section');

function hideAllSections(){
  sections.forEach(s=>s.classList.add('hidden'));
  menuLinks.forEach(m=>m.classList.remove('active-menu','bg-blue-50','text-blue-700','border-r-4','border-blue-600'));
}
function showSection(id){
  hideAllSections();
  document.getElementById('section'+id.charAt(0).toUpperCase()+id.slice(1)).classList.remove('hidden');
  document.querySelector(`[data-page="${id}"]`).classList.add('active-menu','bg-blue-50','text-blue-700','border-r-4','border-blue-600');
}

menuLinks.forEach(link=>{
  link.addEventListener('click', ()=>{
    const page = link.dataset.page;
    showSection(page);
    if(window.innerWidth < 1024) closeSidebar();
    /* trigger original managers */
    if(page==='dashboard' && window.dashboard) dashboard.loadStats();
    if(page==='users' && window.usersManager) usersManager.loadUsers();
    if(page==='attendance' && window.attendanceManager) attendanceManager.loadAttendance();
    if(page==='callHistory' && window.callHistoryManager) callHistoryManager.loadCalls();
    if(page==='callAnalytics' && window.callAnalyticsManager) callAnalyticsManager.loadAnalytics();
    if(page==='performance' && window.performanceManager) performanceManager.loadPerformance();
  });
});

/* ----------  PERFORMANCE BUTTONS  ---------- */
document.getElementById('performanceToday').addEventListener('click',  ()=> performanceManager.loadPerformance('today'));
document.getElementById('performanceWeek').addEventListener('click',   ()=> performanceManager.loadPerformance('week'));
document.getElementById('performanceMonth').addEventListener('click',  ()=> performanceManager.loadPerformance('month'));

/* ----------  LOGOUT  ---------- */
document.getElementById('logoutBtn').addEventListener('click', () => auth.logout());

/* ----------  INITIAL ROUTE  ---------- */
document.addEventListener('DOMContentLoaded', ()=>{
  if(!auth.getToken()){ window.location.href='/admin/login.html'; return; }
  showSection('dashboard');
});
</script>
</body>
</html>

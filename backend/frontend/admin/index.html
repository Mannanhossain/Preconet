<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Nexus Admin Pro Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- Dark Theme Colors (Matching the Image) --- */
        :root {
            --bg-primary: #1e1e2d; /* Main dark background */
            --bg-secondary: #27293d; /* Card/Sidebar background */
            --text-color: #f0f0f0; /* Light text */
            --border-color: #3b3c54; /* Subtle borders */
            --menu-active-bg: #3b82f633; /* Blue with transparency */
            --menu-active-border: #3b82f6;
            --red-critical: #e74c3c;
            --green-positive: #2ecc71;
            --blue-info: #3b82f6;
        }

        body {
            background-color: var(--bg-primary); /* Apply dark primary background to body */
            color: var(--text-color);
        }

        /* Utility Class Overrides for Dark Mode */
        .bg-white { background-color: var(--bg-secondary) !important; }
        .text-gray-800 { color: var(--text-color) !important; }
        .text-gray-500, .text-gray-600, .text-gray-700 { color: #a0a0a0 !important; }
        .border-gray-200, .border-gray-300 { border-color: var(--border-color) !important; }
        .shadow-xl, .shadow-sm { box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4), 0 1px 3px rgba(0, 0, 0, 0.2) !important; }
        .bg-gray-50 { background-color: #333550 !important; } /* Table header */
        .hover\:bg-gray-100:hover { background-color: #333550 !important; } /* Sidebar hover */
        
        /* Input/Select fields - Dark Style */
        input, select {
            background-color: #333550 !important;
            border-color: var(--border-color) !important;
            color: var(--text-color) !important;
        }
        input::placeholder { color: #888; }

        /* Specific Component Styles */
        aside { background-color: var(--bg-secondary) !important; }
        
        .active-menu { 
            background: var(--menu-active-bg); 
            border-right: 4px solid var(--menu-active-border); 
            color: var(--menu-active-border) !important; 
        }
        
        /* Table styles */
        .table-row-hover:hover { background-color: #333550 !important; }
        .divide-gray-200 > tr:not(:last-child) > td { border-bottom-color: var(--border-color) !important; }

        /* Status Badges - Adjusted for Dark Mode */
        .bg-green-100 { background-color: #274737 !important; }
        .text-green-800 { color: var(--green-positive) !important; }
        .bg-red-100 { background-color: #582b2b !important; }
        .text-red-800 { color: var(--red-critical) !important; }
        
        /* General custom styles */
        .hidden-section { display: none; }
        .filter-active { background-color: var(--blue-info) !important; color: white !important; }
        
        /* Modern scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: #555878; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #777b9f; }
        
        /* Card hover effects */
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
        }
        
        @media (max-width: 1024px) {
            aside { position: fixed; left: 0; top: 0; bottom: 0; transform: translateX(-110%); transition: transform .25s ease; z-index: 40; }
            aside.active { transform: translateX(0); }
            main { padding-left: 1rem; }
            #overlay { display: none; }
            #overlay.active { display:block; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:30; }
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="overlay" class="" aria-hidden="true"></div>

    <div class="flex h-screen">

        <aside id="sidebar" class="w-64 bg-white shadow-xl flex flex-col border-r border-gray-200">
            <div class="p-6 border-b border-gray-200 flex items-center justify-between">
                <div>
                    <h1 class="text-xl font-bold text-white">Nexus Admin Pro</h1>
                    <p class="text-sm text-gray-400">Overview</p>
                </div>
                <button id="closeSidebar" class="lg:hidden text-gray-600 hover:bg-gray-100 p-2 rounded-full transition-colors"><i class="fas fa-times"></i></button>
            </div>

            <nav class="flex-1 p-4 space-y-1">
                <a id="menuDashboard" class="menu-item active-menu flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-colors hover:bg-gray-100">
                    <i class="fas fa-chart-pie w-4"></i>
                    <span>Overview</span>
                </a>

                <a id="menuUsers" class="menu-item flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-colors hover:bg-gray-100">
                    <i class="fas fa-users w-4"></i>
                    <span>Users</span>
                </a>

                <a id="menuCreateUser" class="menu-item flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-colors hover:bg-gray-100">
                    <i class="fas fa-user-plus w-4"></i>
                    <span>Create User</span>
                </a>

                <a id="menuAttendance" class="menu-item flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-colors hover:bg-gray-100">
                    <i class="fas fa-calendar-check w-4"></i>
                    <span>Attendance</span>
                </a>

                <a id="menuCallHistory" class="menu-item flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-colors hover:bg-gray-100">
                    <i class="fas fa-phone-alt w-4"></i>
                    <span>Call History</span>
                </a>

                <a id="menuPerformance" class="menu-item flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-colors hover:bg-gray-100">
                    <i class="fas fa-chart-line w-4"></i>
                    <span>Performance</span>
                </a>
            </nav>

            <div class="p-4 border-t border-gray-200">
                <button id="logoutBtn" class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-2.5 rounded-lg flex items-center justify-center gap-2 font-medium transition-all hover:shadow-lg hover:from-red-600 hover:to-red-700">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </aside>

        <main id="mainContent" class="flex-1 overflow-auto p-6 lg:ml-0">

            <header class="flex items-center justify-between mb-8 bg-white p-4 rounded-xl shadow-sm">
                <div class="flex items-center gap-4">
                    <button id="openSidebar" class="lg:hidden text-gray-600 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div>
                        <h2 id="pageTitle" class="text-2xl font-bold text-gray-800">Dashboard</h2>
                        <p id="pageSubtitle" class="text-sm text-gray-500">Executive Summary</p>
                    </div>
                </div>
                <div id="rightHeader" class="flex items-center gap-4">
                    <button class="text-gray-400 hover:text-blue-500 p-2 rounded-full transition-colors"><i class="fas fa-search"></i></button>
                    <button class="text-gray-400 hover:text-blue-500 p-2 rounded-full transition-colors"><i class="fas fa-cog"></i></button>
                    <button class="text-gray-400 hover:text-blue-500 p-2 rounded-full transition-colors"><i class="fas fa-bell"></i></button>
                </div>
            </header>

            <section id="sectionDashboard">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Dashboard</h3>
                    <p class="text-gray-600">Executive Summary</p>
                </div>

                <div id="stats-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card bg-white p-6 rounded-xl shadow-sm card-hover">
                        <p class="text-sm text-gray-500 mb-1">Total Users</p>
                        <h4 class="text-3xl font-bold text-white mb-2">12,890</h4>
                        <p class="text-sm stat-change-up flex items-center gap-1">
                            <i class="fas fa-arrow-up"></i> +3%
                        </p>
                    </div>
                    <div class="stat-card bg-white p-6 rounded-xl shadow-sm card-hover">
                        <p class="text-sm text-gray-500 mb-1">Active Sessions</p>
                        <h4 class="text-3xl font-bold text-white mb-2">9,450</h4>
                        <div class="w-full bg-gray-700 rounded-full h-2.5 mb-2">
                            <div class="bg-purple-500 h-2.5 rounded-full" style="width: 75%"></div>
                        </div>
                        <p class="text-sm stat-change-down flex items-center gap-1">
                            <i class="fas fa-arrow-down"></i> -5%
                        </p>
                    </div>
                    <div class="stat-card bg-white p-6 rounded-xl shadow-sm card-hover">
                        <p class="text-sm text-gray-500 mb-1">Support Tickets</p>
                        <h4 class="text-3xl font-bold text-white mb-2">23 <span class="text-red-500 font-normal text-lg">Critical !</span></h4>
                        <p class="text-sm text-gray-400 flex items-center gap-1">
                            <i class="fas fa-exclamation-triangle text-red-500"></i> Action Required
                        </p>
                    </div>
                    <div class="stat-card bg-white p-6 rounded-xl shadow-sm card-hover">
                        <p class="text-sm text-gray-500 mb-1">Revenue</p>
                        <h4 class="text-3xl font-bold text-white mb-2">$1.2M</h4>
                        <p class="text-sm stat-change-up flex items-center gap-1">
                            <i class="fas fa-arrow-up"></i> +5%
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800 flex items-center gap-2">
                            <i class="fas fa-chart-line text-blue-500"></i> System Performance Trend
                        </h4>
                        <div class="p-4">
                            <canvas id="performanceChart" height="100"></canvas>
                        </div>
                    </div>
                    
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-sm">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800 flex items-center gap-2">
                            <i class="fas fa-history text-yellow-500"></i> Recent Activity Feed
                        </h4>
                        <div id="recent-sync-list" class="space-y-4">
                            <div class="border-l-4 border-blue-500 pl-3">
                                <p class="text-xs text-gray-400">10:13:21</p>
                                <p class="text-white">User "jsmith" updated profile</p>
                            </div>
                            <div class="border-l-4 border-green-500 pl-3">
                                <p class="text-xs text-gray-400">10:03:15</p>
                                <p class="text-white">New report generated: Q3_financlab.pdf</p>
                            </div>
                            <div class="border-l-4 border-purple-500 pl-3">
                                <p class="text-xs text-gray-400">09:52:49</p>
                                <p class="text-white">Server backup completed</p>
                            </div>
                        </div>
                        <h4 class="text-lg font-semibold mt-6 mb-4 text-gray-800 flex items-center gap-2">
                            <i class="fas fa-bolt text-green-500"></i> Quick Access
                        </h4>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="flex flex-col items-center justify-center p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition-colors">
                                <i class="fas fa-plus text-blue-400 text-xl"></i>
                                <p class="text-xs text-gray-400 mt-1">Add New User</p>
                            </div>
                            <div class="flex flex-col items-center justify-center p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition-colors">
                                <i class="fas fa-cogs text-yellow-400 text-xl"></i>
                                <p class="text-xs text-gray-400 mt-1">System Config</p>
                            </div>
                            <div class="flex flex-col items-center justify-center p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-700 transition-colors">
                                <i class="fas fa-file-export text-red-400 text-xl"></i>
                                <p class="text-xs text-gray-400 mt-1">Export Data</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="sectionUsers" class="hidden-section">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Users</h3>
                    <p class="text-gray-600">Manage all users in the system</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                        <div class="relative w-64">
                            <input id="userSearchInput" type="text" placeholder="Search users..." class="w-full pl-10 pr-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <div class="flex gap-2">
                            <select id="userStatusFilter" class="border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="all">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                            <button id="userFilterBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition-colors">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </div>
                    <table class="w-full">
                        <thead class="bg-gray-50 text-left">
                            <tr>
                                <th class="p-4 font-medium text-gray-700">User</th>
                                <th class="p-4 font-medium text-gray-700">Phone</th>
                                <th class="p-4 font-medium text-gray-700">Performance</th>
                                <th class="p-4 font-medium text-gray-700">Status</th>
                                <th class="p-4 font-medium text-gray-700 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody" class="divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="sectionCreateUser" class="hidden-section">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Create User</h3>
                    <p class="text-gray-600">Add a new user to the system</p>
                </div>
                
                <div class="bg-white p-8 rounded-xl shadow-sm">
                    <form id="createUserForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input id="userName" class="w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors" required />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input id="userEmail" type="email" class="w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors" required />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                            <input id="userPhone" class="w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors" />
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <input id="userPassword" type="password" class="w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors" required />
                        </div>
                        <div class="md:col-span-2 flex justify-end">
                            <button type="submit" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-6 rounded-lg font-medium flex items-center gap-2 transition-all hover:shadow-lg">
                                <i class="fas fa-user-plus"></i> Create User
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <section id="sectionAttendance" class="hidden-section">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Attendance</h3>
                    <p class="text-gray-600">Track employee attendance records</p>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                        <div class="flex gap-2">
                            <button id="attendanceToday" class="filter-active bg-blue-600 text-white px-4 py-2 rounded-lg">Today</button>
                            <button id="attendanceWeek" class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors">This Week</button>
                            <button id="attendanceMonth" class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors">This Month</button>
                        </div>
                        <button id="exportAttendance" class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-gray-50 transition-colors">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="p-4 font-medium text-gray-700 text-left">User</th>
                                <th class="p-4 font-medium text-gray-700 text-left">Check In</th>
                                <th class="p-4 font-medium text-gray-700 text-left">Check Out</th>
                                <th class="p-4 font-medium text-gray-700 text-left">Status</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody" class="divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </section>

            <section id="sectionCallHistory" class="hidden-section">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Call History</h3>
                    <p class="text-gray-600">Review all call records and analytics</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <div class="mb-4 flex gap-4">
                        <div class="relative w-64">
                            <input id="callSearchInput" type="text" placeholder="Search calls..." class="w-full pl-10 pr-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <select id="callTypeFilter" class="border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="all">All Call Types</option>
                            <option value="incoming">Incoming</option>
                            <option value="outgoing">Outgoing</option>
                            <option value="missed">Missed</option>
                        </select>
                    </div>
                    <div id="callHistoryContainer"></div>
                </div>
            </section>

            <section id="sectionPerformance" class="hidden-section">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Performance</h3>
                    <p class="text-gray-600">Monitor team performance metrics</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <div class="mb-4 flex gap-4">
                        <button id="performanceToday" class="filter-active bg-blue-600 text-white px-4 py-2 rounded-lg">Today</button>
                        <button id="performanceWeek" class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors">This Week</button>
                        <button id="performanceMonth" class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors">This Month</button>
                    </div>
                    <canvas id="performanceBarCanvas" height="100"></canvas>
                </div>
            </section>

        </main>
    </div>

    <div id="notificationArea" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script src="/admin/js/auth.js"></script>

    <script src="/admin/js/dashboard.js"></script>
    <script src="/admin/js/create_user.js"></script>
    <script src="/admin/js/attendance.js"></script>
    <script src="/admin/js/call_history.js"></script>
    <script src="/admin/js/call_analytics.js"></script>
    <script src="/admin/js/performance.js"></script>
    <script src="/admin/js/admin.js"></script>

    <script>
        // Mock Data for Users
        const mockUsersData = [
            { name: "Alex Johnson", phone: "555-0101", performance: "92%", status: "active" },
            { name: "Jane Smith", phone: "555-0102", performance: "75%", status: "inactive" },
            { name: "Michael Lee", phone: "555-0103", performance: "88%", status: "active" },
            { name: "Sarah Connor", phone: "555-0104", performance: "61%", status: "inactive" },
            { name: "Chris Evans", phone: "555-0105", performance: "95%", status: "active" },
            { name: "Emily Blunt", phone: "555-0106", performance: "82%", status: "active" },
            { name: "Tom Holland", phone: "555-0107", performance: "70%", status: "inactive" },
        ];

        // --- Working UsersManager Implementation for Search/Filter ---
        class UsersManager {
            constructor() {
                this.users = mockUsersData;
                this.tableBody = document.getElementById('usersTableBody');
            }

            loadUsers(filters = {}) {
                const { search = '', status = 'all' } = filters;
                
                let filteredUsers = this.users.filter(user => {
                    const matchesSearch = user.name.toLowerCase().includes(search.toLowerCase());
                    const matchesStatus = status === 'all' || user.status === status;
                    return matchesSearch && matchesStatus;
                });

                this.renderUsers(filteredUsers);
            }

            renderUsers(users) {
                if (!this.tableBody) return;
                this.tableBody.innerHTML = ''; // Clear existing rows

                if (users.length === 0) {
                    this.tableBody.innerHTML = `<tr><td colspan="5" class="p-4 text-center text-gray-500">No users found matching your criteria.</td></tr>`;
                    return;
                }

                users.forEach(user => {
                    const statusClass = user.status === 'active' 
                        ? 'bg-green-100 text-green-800' 
                        : 'bg-red-100 text-red-800';

                    const row = document.createElement('tr');
                    row.className = 'table-row-hover transition-colors';
                    row.innerHTML = `
                        <td class="p-4 flex items-center gap-3">
                            <i class="fas fa-user-circle text-2xl text-blue-500"></i>
                            <span class="font-medium text-white">${user.name}</span>
                        </td>
                        <td class="p-4 text-gray-400">${user.phone}</td>
                        <td class="p-4 text-gray-400">${user.performance}</td>
                        <td class="p-4">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${statusClass}">
                                ${user.status.charAt(0).toUpperCase() + user.status.slice(1)}
                            </span>
                        </td>
                        <td class="p-4 text-right">
                            <button class="text-blue-500 hover:text-blue-400 p-2 rounded-full transition-colors">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-400 p-2 rounded-full transition-colors">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    this.tableBody.appendChild(row);
                });
            }
            
            createUser() {
                // Mock create user logic
                console.log("Creating new user...");
            }
        }
        // --- END UsersManager Implementation ---

        // -------------------------
        // Ensure managers exist and avoid duplicates
        // We use our working UsersManager now.
        // -------------------------
        window.dashboard = window.dashboard || {};
        window.usersManager = new UsersManager(); // Use our working class
        window.attendanceManager = window.attendanceManager || { loadAttendance: (range) => console.log('Loading attendance:', range) };
        window.callHistoryManager = window.callHistoryManager || { loadCalls: (filters) => console.log('Loading calls:', filters) };
        window.callAnalyticsManager = window.callAnalyticsManager || {};
        window.performanceManager = window.performanceManager || { loadPerformance: (range) => console.log('Loading performance:', range) };


        window.menuDashboard = document.getElementById('menuDashboard');
        window.menuUsers = document.getElementById('menuUsers');
        window.menuCreateUser = document.getElementById('menuCreateUser');
        window.menuAttendance = document.getElementById('menuAttendance');
        window.menuCallHistory = document.getElementById('menuCallHistory');
        window.menuPerformance = document.getElementById('menuPerformance');

        window.sectionDashboard = document.getElementById('sectionDashboard');
        window.sectionUsers = document.getElementById('sectionUsers');
        window.sectionCreateUser = document.getElementById('sectionCreateUser');
        window.sectionAttendance = document.getElementById('sectionAttendance');
        window.sectionCallHistory = document.getElementById('sectionCallHistory');
        window.sectionPerformance = document.getElementById('sectionPerformance');

        window.logoutBtn = document.getElementById('logoutBtn');

        // -------------------------
        // Mobile sidebar wiring
        // -------------------------
        document.getElementById('openSidebar')?.addEventListener('click', () => {
            document.getElementById('sidebar')?.classList.add('active');
            document.getElementById('overlay')?.classList.add('active');
        });
        document.getElementById('closeSidebar')?.addEventListener('click', () => {
            document.getElementById('sidebar')?.classList.remove('active');
            document.getElementById('overlay')?.classList.remove('active');
        });
        document.getElementById('overlay')?.addEventListener('click', () => {
            document.getElementById('sidebar')?.classList.remove('active');
            document.getElementById('overlay')?.classList.remove('active');
        });

        // -------------------------
        // Page navigation handlers
        // -------------------------
        function updateHeader(title, subtitle) {
            document.getElementById('pageTitle').textContent = title;
            document.getElementById('pageSubtitle').textContent = subtitle;
        }

        function hideAll() {
            [sectionDashboard, sectionUsers, sectionCreateUser, sectionAttendance, sectionCallHistory, sectionPerformance]
                .forEach(s => s?.classList.add('hidden-section'));
            document.querySelectorAll('.menu-item')?.forEach(m => m.classList.remove('active-menu'));
        }

        menuDashboard.onclick = () => {
            hideAll();
            sectionDashboard.classList.remove('hidden-section');
            menuDashboard.classList.add('active-menu');
            updateHeader('Dashboard', 'Executive Summary');
            // if (dashboard && typeof dashboard.loadStats === 'function') dashboard.loadStats();
        };

        menuUsers.onclick = () => {
            hideAll();
            sectionUsers.classList.remove('hidden-section');
            menuUsers.classList.add('active-menu');
            updateHeader('Users', 'Manage all users in the system');
            if (usersManager && typeof usersManager.loadUsers === 'function') usersManager.loadUsers(); // Load all initially
        };

        menuCreateUser.onclick = () => {
            hideAll();
            sectionCreateUser.classList.remove('hidden-section');
            menuCreateUser.classList.add('active-menu');
            updateHeader('Create User', 'Add a new user to the system');
        };

        menuAttendance.onclick = () => {
            hideAll();
            sectionAttendance.classList.remove('hidden-section');
            menuAttendance.classList.add('active-menu');
            updateHeader('Attendance', 'Track employee attendance records');
            if (attendanceManager && typeof attendanceManager.loadAttendance === 'function') attendanceManager.loadAttendance('today');
        };

        menuCallHistory.onclick = () => {
            hideAll();
            sectionCallHistory.classList.remove('hidden-section');
            menuCallHistory.classList.add('active-menu');
            updateHeader('Call History', 'Review all call records and analytics');
            if (callHistoryManager && typeof callHistoryManager.loadCalls === 'function') callHistoryManager.loadCalls();
        };

        menuPerformance.onclick = () => {
            hideAll();
            sectionPerformance.classList.remove('hidden-section');
            menuPerformance.classList.add('active-menu');
            updateHeader('Performance', 'Monitor team performance metrics');
            if (performanceManager && typeof performanceManager.loadPerformance === 'function') performanceManager.loadPerformance('today');
        };

        // Logout
        logoutBtn.addEventListener('click', () => {
            // auth.logout() 
            alert('Logged out (mock)');
        });

        // Auto-run dashboard when DOM ready
        document.addEventListener('DOMContentLoaded', () => {
            // if (!auth.getToken()) { window.location.href = "/admin/login.html"; return; } // Removed real auth logic
            menuDashboard.click();
            initializeFilters();
        });

        // Wire create user form submit
        document.getElementById('createUserForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            if (usersManager && typeof usersManager.createUser === 'function') usersManager.createUser();
        });

        // -------------------------
        // Filter and Search Functionality (Working)
        // -------------------------
        function initializeFilters() {
            // Users section filters
            const userSearchInput = document.getElementById('userSearchInput');
            const userStatusFilter = document.getElementById('userStatusFilter');
            
            if (userSearchInput) {
                userSearchInput.addEventListener('input', debounce(function() {
                    filterUsers();
                }, 300));
            }
            
            if (userStatusFilter) {
                userStatusFilter.addEventListener('change', filterUsers);
            }
            
            // The explicit filter button is not strictly needed since search/select trigger it, 
            // but we keep the handler to be complete.
            document.getElementById('userFilterBtn')?.addEventListener('click', filterUsers);


            // Attendance section date filters
            const attendanceToday = document.getElementById('attendanceToday');
            const attendanceWeek = document.getElementById('attendanceWeek');
            const attendanceMonth = document.getElementById('attendanceMonth');
            const exportAttendance = document.getElementById('exportAttendance');
            
            if (attendanceToday) {
                attendanceToday.addEventListener('click', function() {
                    setActiveFilter(this, [attendanceWeek, attendanceMonth]);
                    filterAttendance('today');
                });
            }
            
            if (attendanceWeek) {
                attendanceWeek.addEventListener('click', function() {
                    setActiveFilter(this, [attendanceToday, attendanceMonth]);
                    filterAttendance('week');
                });
            }
            
            if (attendanceMonth) {
                attendanceMonth.addEventListener('click', function() {
                    setActiveFilter(this, [attendanceToday, attendanceWeek]);
                    filterAttendance('month');
                });
            }
            
            if (exportAttendance) {
                exportAttendance.addEventListener('click', exportAttendanceData);
            }
            
            // Call History filters
            const callSearchInput = document.getElementById('callSearchInput');
            const callTypeFilter = document.getElementById('callTypeFilter');
            
            if (callSearchInput) {
                callSearchInput.addEventListener('input', debounce(function() {
                    filterCalls();
                }, 300));
            }
            
            if (callTypeFilter) {
                callTypeFilter.addEventListener('change', filterCalls);
            }
            
            // Performance section date filters
            const performanceToday = document.getElementById('performanceToday');
            const performanceWeek = document.getElementById('performanceWeek');
            const performanceMonth = document.getElementById('performanceMonth');
            
            if (performanceToday) {
                performanceToday.addEventListener('click', function() {
                    setActiveFilter(this, [performanceWeek, performanceMonth]);
                    filterPerformance('today');
                });
            }
            
            if (performanceWeek) {
                performanceWeek.addEventListener('click', function() {
                    setActiveFilter(this, [performanceToday, performanceMonth]);
                    filterPerformance('week');
                });
            }
            
            if (performanceMonth) {
                performanceMonth.addEventListener('click', function() {
                    setActiveFilter(this, [performanceToday, performanceWeek]);
                    filterPerformance('month');
                });
            }
        }
        
        // Helper function to set active filter button
        function setActiveFilter(activeElement, otherElements) {
            activeElement.classList.add('filter-active', 'bg-blue-600', 'text-white');
            activeElement.classList.remove('bg-white', 'text-gray-700', 'border', 'border-gray-300');
            
            otherElements.forEach(element => {
                element.classList.remove('filter-active', 'bg-blue-600', 'text-white');
                element.classList.add('bg-white', 'text-gray-700', 'border', 'border-gray-300');
            });
        }
        
        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Filter functions for each section
        function filterUsers() {
            const searchTerm = document.getElementById('userSearchInput').value;
            const statusFilter = document.getElementById('userStatusFilter').value;
            
            if (window.usersManager && typeof window.usersManager.loadUsers === 'function') {
                window.usersManager.loadUsers({ search: searchTerm, status: statusFilter });
            }
            
            console.log('Filtering users:', { searchTerm, statusFilter });
        }
        
        function filterAttendance(timeRange) {
            if (window.attendanceManager && typeof window.attendanceManager.loadAttendance === 'function') {
                window.attendanceManager.loadAttendance(timeRange);
            }
            console.log('Filtering attendance by:', timeRange);
        }
        
        function filterCalls() {
            const searchTerm = document.getElementById('callSearchInput').value.toLowerCase();
            const callType = document.getElementById('callTypeFilter').value;
            
            if (window.callHistoryManager && typeof window.callHistoryManager.loadCalls === 'function') {
                window.callHistoryManager.loadCalls({ search: searchTerm, type: callType });
            }
            console.log('Filtering calls:', { searchTerm, callType });
        }
        
        function filterPerformance(timeRange) {
            if (window.performanceManager && typeof window.performanceManager.loadPerformance === 'function') {
                window.performanceManager.loadPerformance(timeRange);
            }
            console.log('Filtering performance by:', timeRange);
        }
        
        function exportAttendanceData() {
            console.log('Exporting attendance data...');
            if (window.showNotification) {
                window.showNotification('Attendance data exported successfully!', 'success');
            } else {
                alert('Attendance data exported successfully!');
            }
        }
    </script>
</body>
</html>

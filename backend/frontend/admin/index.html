<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Call Manager Pro â€“ Admin Panel</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <style>
        .sidebar {
            transition: all .3s ease;
            transform: translateX(-100%);
        }
        .sidebar.active { transform: translateX(0); }
        .overlay {
            display:none;
            position:fixed; inset:0; background:rgba(0,0,0,0.5);
        }
        .overlay.active { display:block; }
        @media(min-width:1024px){
            .sidebar{ transform:translateX(0)!important; }
            .overlay{ display:none!important; }
        }
        .active-menu{
            background:#e0f2fe;
            border-right:4px solid #0284c7;
        }
    </style>
</head>

<body class="bg-gray-100 flex h-screen">

<!-- MOBILE OVERLAY -->
<div id="overlay" class="overlay"></div>

<!-- SIDEBAR -->
<aside id="sidebar" class="sidebar bg-white w-64 h-full fixed shadow-lg z-40">

    <div class="p-6 border-b flex justify-between items-center">
        <div>
            <h1 class="text-xl font-bold">Admin Panel</h1>
            <p class="text-sm text-gray-500">Call Manager Pro</p>
        </div>
        <button id="closeSidebar" class="lg:hidden">
            <i class="fas fa-times text-xl text-gray-600"></i>
        </button>
    </div>

    <nav class="p-4 space-y-2">

        <a id="menuDashboard" class="menu-item active-menu flex items-center space-x-3 p-3 cursor-pointer rounded">
            <i class="fas fa-chart-pie"></i> <span>Dashboard</span>
        </a>

        <a id="menuUsers" class="menu-item flex items-center space-x-3 p-3 cursor-pointer rounded">
            <i class="fas fa-users"></i> <span>Users</span>
        </a>

        <a id="menuCreateUser" class="menu-item flex items-center space-x-3 p-3 cursor-pointer rounded">
            <i class="fas fa-user-plus"></i> <span>Create User</span>
        </a>

        <a id="menuAttendance" class="menu-item flex items-center space-x-3 p-3 cursor-pointer rounded">
            <i class="fas fa-calendar-check"></i> <span>Attendance</span>
        </a>

        <a id="menuCallHistory" class="menu-item flex items-center space-x-3 p-3 cursor-pointer rounded">
            <i class="fas fa-phone-alt"></i> <span>Call History</span>
        </a>

        <a id="menuPerformance" class="menu-item flex items-center space-x-3 p-3 cursor-pointer rounded">
            <i class="fas fa-chart-line"></i> <span>Performance</span>
        </a>

    </nav>

    <div class="absolute bottom-0 left-0 right-0 p-4 border-t">
        <button id="logoutBtn"
                class="bg-red-600 text-white px-4 py-2 rounded w-full flex items-center justify-center gap-2">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>

</aside>

<!-- MAIN PAGE -->
<main class="lg:ml-64 flex-1 overflow-auto">

    <!-- HEADER -->
    <header class="bg-white shadow p-4 flex justify-between items-center sticky top-0 z-30">
        <div class="flex items-center gap-4">
            <button id="openSidebar" class="lg:hidden text-gray-600">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold">Dashboard</h2>
        </div>
    </header>

    <!-- CONTENT WRAPPER -->
    <div class="p-6">

        <!-- DASHBOARD SECTION -->
        <section id="sectionDashboard">
            <h3 class="text-xl font-semibold mb-4">Dashboard</h3>

            <div id="stats-cards" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"></div>

            <h4 class="text-lg font-semibold mb-2">Recent Sync Activity</h4>
            <div id="recent-sync-list" class="space-y-2 mb-6"></div>

            <h4 class="text-lg font-semibold mb-2">User Activity Logs</h4>
            <div id="user-logs-container" class="space-y-2"></div>

            <h4 class="text-lg font-semibold mt-6 mb-2">Performance Trend</h4>
            <canvas id="performanceChart" height="120"></canvas>
        </section>

        <!-- USERS SECTION -->
        <section id="sectionUsers" class="hidden">
            <h3 class="text-xl font-semibold mb-4">All Users</h3>
            <table class="w-full bg-white rounded shadow overflow-hidden">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="p-3">User</th>
                        <th class="p-3">Phone</th>
                        <th class="p-3">Performance</th>
                        <th class="p-3">Status</th>
                        <th class="p-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody"></tbody>
            </table>
        </section>

        <!-- CREATE USER -->
        <section id="sectionCreateUser" class="hidden">
            <h3 class="text-xl font-semibold mb-4">Create User</h3>
            <form id="createUserForm" class="bg-white p-6 rounded shadow grid grid-cols-1 md:grid-cols-2 gap-4">

                <div class="md:col-span-2">
                    <label>Name</label>
                    <input id="userName" class="border p-2 w-full rounded" required />
                </div>

                <div>
                    <label>Email</label>
                    <input id="userEmail" type="email" class="border p-2 w-full rounded" required />
                </div>

                <div>
                    <label>Phone</label>
                    <input id="userPhone" class="border p-2 w-full rounded" />
                </div>

                <div class="md:col-span-2">
                    <label>Password</label>
                    <input id="userPassword" type="password" class="border p-2 w-full rounded" required />
                </div>

                <button type="submit" class="md:col-span-2 bg-blue-600 text-white py-2 rounded">
                    Create User
                </button>

            </form>
        </section>

        <!-- ATTENDANCE -->
        <section id="sectionAttendance" class="hidden">
            <h3 class="text-xl font-semibold mb-4">Attendance</h3>
            <div id="attendance-cards-container" class="grid gap-4"></div>
        </section>

        <!-- CALL HISTORY -->
        <section id="sectionCallHistory" class="hidden">
            <h3 class="text-xl font-semibold mb-4">Call History</h3>
            <div id="call-history-container"></div>
        </section>

        <!-- PERFORMANCE -->
        <section id="sectionPerformance" class="hidden">
            <h3 class="text-xl font-semibold mb-4">Performance</h3>
            <canvas id="performanceBarCanvas"></canvas>
        </section>

    </div>

</main>

<!-- SCRIPTS -->
<script src="/admin/js/auth.js"></script>
<script src="/admin/js/dashboard.js"></script>
<script src="/admin/js/users.js"></script>
<script src="/admin/js/attendance.js"></script>
<script src="/admin/js/call_history.js"></script>
<script src="/admin/js/performance.js"></script>

<script>
// SIDEBAR TOGGLE
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");

document.getElementById("openSidebar").onclick = () => {
    sidebar.classList.add("active");
    overlay.classList.add("active");
};
document.getElementById("closeSidebar").onclick = () => {
    sidebar.classList.remove("active");
    overlay.classList.remove("active");
};
overlay.onclick = () => {
    sidebar.classList.remove("active");
    overlay.classList.remove("active");
};

// MENU LOGIC
const sections = {
    dashboard: sectionDashboard,
    users: sectionUsers,
    createUser: sectionCreateUser,
    attendance: sectionAttendance,
    callHistory: sectionCallHistory,
    performance: sectionPerformance
};

function hideAll() {
    Object.values(sections).forEach(s => s.classList.add("hidden"));
    document.querySelectorAll(".menu-item").forEach(m => m.classList.remove("active-menu"));
}

menuDashboard.onclick = () => {
    hideAll();
    sectionDashboard.classList.remove("hidden");
    menuDashboard.classList.add("active-menu");
    dashboard.loadStats();
};

menuUsers.onclick = () => {
    hideAll();
    sectionUsers.classList.remove("hidden");
    menuUsers.classList.add("active-menu");
    usersManager.loadUsers();
};

menuCreateUser.onclick = () => {
    hideAll();
    sectionCreateUser.classList.remove("hidden");
    menuCreateUser.classList.add("active-menu");
};

menuAttendance.onclick = () => {
    hideAll();
    sectionAttendance.classList.remove("hidden");
    menuAttendance.classList.add("active-menu");
    attendanceManager.loadAttendance();
};

menuCallHistory.onclick = () => {
    hideAll();
    sectionCallHistory.classList.remove("hidden");
    menuCallHistory.classList.add("active-menu");
    callHistoryManager.loadCalls();
};

menuPerformance.onclick = () => {
    hideAll();
    sectionPerformance.classList.remove("hidden");
    menuPerformance.classList.add("active-menu");
    performanceManager.loadPerformance();
};

// LOGOUT
logoutBtn.onclick = () => auth.logout();

// AUTO LOAD DASHBOARD
document.addEventListener("DOMContentLoaded", () => {
    dashboard.loadStats();
});
</script>

</body>
</html>
